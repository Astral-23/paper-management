<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>論文管理システム</title>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
        integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3NU" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
        integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUbKyIyuh"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked-katex-extension/lib/index.umd.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css?v=2">
</head>

<body class="antialiased">

    <div id="auth-modal" class="fixed inset-0 bg-black/60 hidden items-center justify-center p-4 z-50 backdrop-blur-sm">
        <div class="bg-[var(--card-background)] rounded-xl shadow-2xl w-full max-w-md border border-[var(--border-color)]">
            <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                <h3 class="text-lg font-bold text-[var(--foreground)]">管理者ログイン</h3>
                <button id="close-auth-modal-btn" class="text-[var(--muted-foreground)] hover:text-[var(--foreground)] text-2xl font-bold">&times;</button>
            </div>
            <div class="p-6">
                <form id="login-form" class="space-y-6">
                    <div class="rounded-md -space-y-px">
                        <input id="email-address" name="email" type="email" autocomplete="email" required
                            class="appearance-none rounded-t-md relative block w-full px-3 py-2 bg-[var(--input-background)] border border-[var(--input-border-color)] placeholder-[var(--muted-foreground)] focus:outline-none focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)] focus:z-10 sm:text-sm"
                            placeholder="メールアドレス">
                        <input id="password" name="password" type="password" autocomplete="current-password" required
                            class="appearance-none rounded-b-md relative block w-full px-3 py-2 bg-[var(--input-background)] border border-[var(--input-border-color)] placeholder-[var(--muted-foreground)] focus:outline-none focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)] focus:z-10 sm:text-sm"
                            placeholder="パスワード">
                    </div>
                    <div id="auth-error" class="text-red-500 text-sm hidden"></div>
                    <button type="submit"
                        class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-[var(--primary-color)] hover:bg-[var(--primary-hover-color)] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--primary-color)] transition-colors">
                        ログイン
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <div id="note-modal" class="fixed inset-0 bg-black/60 hidden items-center justify-center p-4 z-50 backdrop-blur-sm">
        <div class="bg-[var(--card-background)] border border-[var(--border-color)] rounded-xl shadow-2xl w-full max-w-4xl h-[80vh] flex flex-col">
            <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center flex-shrink-0">
                <h3 class="text-lg font-bold truncate pr-4" id="note-modal-title">メモを編集</h3>
                <button id="close-modal-btn" class="text-[var(--muted-foreground)] hover:text-[var(--foreground)] text-2xl font-bold">&times;</button>
            </div>
            <div class="flex-1 grid grid-cols-1 md:grid-cols-2 gap-4 p-4 overflow-hidden">
                <div class="flex flex-col h-full">
                    <label for="note-editor" class="text-sm font-medium mb-2 text-[var(--muted-foreground)]">Markdownエディタ</label>
                    <textarea id="note-editor" class="w-full flex-1 p-2 bg-[var(--input-background)] border border-[var(--input-border-color)] rounded-md resize-none font-mono text-sm focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)]" placeholder="ここにMarkdownでメモを入力..."></textarea>
                </div>
                <div class="flex flex-col h-full">
                    <label class="text-sm font-medium mb-2 text-[var(--muted-foreground)]">プレビュー</label>
                    <div id="note-preview" class="w-full flex-1 p-3 border border-[var(--border-color)] rounded-md overflow-y-auto prose prose-sm max-w-none"></div>
                </div>
            </div>
            <div class="p-4 bg-[var(--background)] border-t border-[var(--border-color)] flex justify-end space-x-2 flex-shrink-0 rounded-b-xl">
                <button id="cancel-note-btn" class="px-4 py-2 bg-gray-200 dark:bg-slate-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-slate-600 transition-colors">キャンセル</button>
                <button id="save-note-btn" class="px-4 py-2 bg-[var(--primary-color)] text-white rounded-md hover:bg-[var(--primary-hover-color)] transition-colors">保存する</button>
            </div>
        </div>
    </div>
    
    <div id="edit-modal" class="fixed inset-0 bg-black/60 hidden items-center justify-center p-4 z-50 backdrop-blur-sm">
        <div class="bg-[var(--card-background)] rounded-xl shadow-2xl w-full max-w-2xl flex flex-col border border-[var(--border-color)]">
            <div class="p-4 border-b border-[var(--border-color)] flex justify-between items-center">
                <h3 class="text-lg font-bold" id="edit-modal-title">論文情報を編集</h3>
                <button id="close-edit-modal-btn" class="text-[var(--muted-foreground)] hover:text-[var(--foreground)] text-2xl font-bold">&times;</button>
            </div>
            <div class="p-6 space-y-4 overflow-y-auto" style="max-height: 70vh;">
                <form id="edit-paper-form" class="space-y-4">
                    <div>
                        <label for="edit-title" class="block text-sm font-medium text-[var(--muted-foreground)] mb-1">タイトル <span class="text-red-500">*</span></label>
                        <input type="text" id="edit-title" class="w-full px-3 py-2 bg-[var(--input-background)] border border-[var(--input-border-color)] rounded-md shadow-sm focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)]" required>
                    </div>
                    <div>
                        <label for="edit-authors" class="block text-sm font-medium text-[var(--muted-foreground)] mb-1">著者 (カンマ区切り)</label>
                        <input type="text" id="edit-authors" class="w-full px-3 py-2 bg-[var(--input-background)] border border-[var(--input-border-color)] rounded-md shadow-sm focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)]">
                    </div>
                    <div>
                        <label for="edit-url" class="block text-sm font-medium text-[var(--muted-foreground)] mb-1">URL</label>
                        <input type="url" id="edit-url" class="w-full px-3 py-2 bg-[var(--input-background)] border border-[var(--input-border-color)] rounded-md shadow-sm focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)]">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="edit-year" class="block text-sm font-medium text-[var(--muted-foreground)] mb-1">発行年</label>
                            <input type="number" id="edit-year" class="w-full px-3 py-2 bg-[var(--input-background)] border border-[var(--input-border-color)] rounded-md shadow-sm focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)]">
                        </div>
                        <div>
                            <label for="edit-citations" class="block text-sm font-medium text-[var(--muted-foreground)] mb-1">被引用数</label>
                            <input type="number" id="edit-citations" class="w-full px-3 py-2 bg-[var(--input-background)] border border-[var(--input-border-color)] rounded-md shadow-sm focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)]">
                        </div>
                    </div>
                    <div>
                        <label for="edit-category" class="block text-sm font-medium text-[var(--muted-foreground)] mb-1">カテゴリ</label>
                        <input type="text" id="edit-category" class="w-full px-3 py-2 bg-[var(--input-background)] border border-[var(--input-border-color)] rounded-md shadow-sm focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)]">
                    </div>
                </form>
            </div>
            <div class="p-4 bg-[var(--background)] border-t border-[var(--border-color)] flex justify-end space-x-2 rounded-b-xl">
                <button id="cancel-edit-btn" class="px-4 py-2 bg-gray-200 dark:bg-slate-700 text-gray-800 dark:text-gray-200 rounded-md hover:bg-gray-300 dark:hover:bg-slate-600 transition-colors">キャンセル</button>
                <button id="save-edit-btn" class="px-4 py-2 bg-[var(--primary-color)] text-white rounded-md hover:bg-[var(--primary-hover-color)] transition-colors">変更を保存</button>
            </div>
        </div>
    </div>


    <div class="container mx-auto p-4 md:p-8">
        <header class="mb-8 flex justify-between items-center pb-4 border-b border-[var(--border-color)] transition-colors">
            <div class="flex items-center space-x-4">
                <div class="flex items-center space-x-3">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8 text-[var(--primary-color)] transition-colors">
                        <path d="M11.25 4.533A9.707 9.707 0 006 3a9.735 9.735 0 00-3.25.555.75.75 0 00-.5.707v14.5a.75.75 0 00.5.707A9.735 9.735 0 006 21a9.707 9.707 0 005.25-1.533.75.75 0 00.5-1.332V5.865a.75.75 0 00-.5-1.332z" />
                        <path d="M12.75 4.533A9.707 9.707 0 0118 3a9.735 9.735 0 013.25.555.75.75 0 01.5.707v14.5a.75.75 0 01-.5.707A9.735 9.735 0 0118 21a9.707 9.707 0 01-5.25-1.533.75.75 0 01-.5-1.332V5.865a.75.75 0 01.5-1.332z" />
                    </svg>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-[var(--foreground)] tracking-tight">論文管理システム</h1>
                </div>
                <div id="view-switcher" class="flex items-center space-x-2">
                    <button id="show-list-btn" class="view-switch-btn active">リスト</button>
                    <button id="show-other-btn" class="view-switch-btn">その他</button>
                </div>
            </div>
            <div class="flex items-center space-x-2">
                <div id="theme-switcher" class="relative">
                    <button id="theme-menu-button" class="p-2 rounded-full hover:bg-[var(--card-hover-background)] text-[var(--muted-foreground)] transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="M10 3a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM10 8.5a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM11.5 15.5a1.5 1.5 0 10-3 0 1.5 1.5 0 003 0z" /></svg>
                    </button>
                    <div id="theme-menu" class="absolute right-0 mt-2 w-36 origin-top-right rounded-md bg-[var(--card-background)] shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none hidden z-10 border border-[var(--border-color)]">
                        <div class="py-1" role="none">
                            <a href="#" class="theme-option" data-theme="light">Light</a>
                            <a href="#" class="theme-option" data-theme="snow">Snow</a>
                            <a href="#" class="theme-option" data-theme="metallic">Metallic</a>
                        </div>
                    </div>
                </div>
                <button id="login-btn" class="bg-[var(--primary-color)] hover:bg-[var(--primary-hover-color)] text-white font-bold py-2 px-4 rounded-lg transition-colors">管理者ログイン</button>
                <button id="logout-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition-colors hidden">ログアウト</button>
            </div>
        </header>

        <div id="list-page">
            <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <aside class="lg:col-span-1 admin-only">
                    <div class="bg-[var(--card-background)] border border-[var(--border-color)] p-6 rounded-xl shadow-sm sticky top-8 transition-colors" style="background: var(--card-background)">
                        <h2 class="text-xl font-bold mb-4" id="form-title">論文を追加</h2>
                        <form id="paper-form" autocomplete="off" class="space-y-4">
                            <div>
                                <label for="paper-title" class="block text-sm font-medium text-[var(--muted-foreground)] mb-1">タイトルまたはURL <span class="text-red-500">*</span></label>
                                <div class="flex items-center space-x-2">
                                    <input type="text" id="paper-title" class="w-full px-3 py-2 bg-[var(--input-background)] border border-[var(--input-border-color)] rounded-md shadow-sm focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)]" placeholder="論文のタイトルやURLを入力..." required>
                                    <button type="button" id="autocomplete-btn" title="入力された情報から論文データを自動補完します" class="p-2 bg-[var(--primary-color)]/10 text-[var(--primary-color)] rounded-md hover:bg-[var(--primary-color)]/20 flex-shrink-0 transition-colors">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" /></svg>
                                    </button>
                                </div>
                            </div>
                            <div>
                                <label for="paper-authors" class="block text-sm font-medium text-[var(--muted-foreground)] mb-1">著者 (カンマ区切り)</label>
                                <input type="text" id="paper-authors" class="w-full px-3 py-2 bg-[var(--input-background)] border border-[var(--input-border-color)] rounded-md shadow-sm focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)]">
                            </div>
                            <div>
                                <label for="paper-url-display" class="block text-sm font-medium text-[var(--muted-foreground)] mb-1">URL</label>
                                <input type="url" id="paper-url-display" class="w-full px-3 py-2 bg-[var(--input-background)] border border-[var(--input-border-color)] rounded-md shadow-sm focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)]">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="paper-year" class="block text-sm font-medium text-[var(--muted-foreground)] mb-1">発行年</label>
                                    <input type="number" id="paper-year" class="w-full px-3 py-2 bg-[var(--input-background)] border border-[var(--input-border-color)] rounded-md shadow-sm focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)]">
                                </div>
                                <div>
                                    <label for="paper-citations" class="block text-sm font-medium text-[var(--muted-foreground)] mb-1">被引用数</label>
                                    <input type="number" id="paper-citations" class="w-full px-3 py-2 bg-[var(--input-background)] border border-[var(--input-border-color)] rounded-md shadow-sm focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)]">
                                </div>
                            </div>
                            <hr class="border-[var(--border-color)] pt-4"/>
                            <div>
                                <label for="paper-category" class="block text-sm font-medium text-[var(--muted-foreground)] mb-1">カテゴリ</label>
                                <input type="text" id="paper-category" name="paper-category" class="w-full px-3 py-2 bg-[var(--input-background)] border border-[var(--input-border-color)] rounded-md shadow-sm focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)]" placeholder="例: 強化学習">
                            </div>
                            <div>
                                <label for="paper-note" class="block text-sm font-medium text-[var(--muted-foreground)] mb-1">メモ (簡易)</label>
                                <textarea id="paper-note" name="paper-note" rows="3" class="w-full px-3 py-2 bg-[var(--input-background)] border border-[var(--input-border-color)] rounded-md shadow-sm focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)]" placeholder="簡単なメモはこちらに..."></textarea>
                            </div>
                            <button type="submit" id="add-paper-btn" class="mt-6 w-full bg-[var(--primary-color)] text-white font-semibold py-2.5 px-4 rounded-lg hover:bg-[var(--primary-hover-color)] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[var(--primary-color)] focus:ring-offset-[var(--background)] flex items-center justify-center transition-all duration-200">
                                <span id="btn-text">追加する</span>
                                <div id="btn-loader" class="loader !border-t-white !w-5 !h-5 hidden"></div>
                            </button>
                        </form>
                    </div>
                </aside>
                <div class="lg:col-span-2">
                    <div class="mb-6 flex items-center gap-4 flex-wrap">
                        <div class="inline-flex rounded-lg shadow-sm border border-[var(--border-color)]">
                            <button id="filter-all" class="filter-btn">すべて</button>
                            <button id="filter-to-read" class="filter-btn">優先</button>
                            <button id="filter-unread" class="filter-btn">未読</button>
                            <button id="filter-skimmed" class="filter-btn">流し読み</button>
                            <button id="filter-read" class="filter-btn">既読</button>
                        </div>
                        <select id="category-filter" class="rounded-lg bg-[var(--input-background)] border-[var(--input-border-color)] shadow-sm focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)]"></select>
                    </div>
                    <section id="papers-container">
                        <div id="skeleton-loader">
                            <div class="skeleton-card space-y-4">
                                <div class="skeleton h-5 w-3/4"></div>
                                <div class="skeleton h-4 w-1/2"></div>
                                <div class="flex space-x-4"><div class="skeleton h-4 w-1/4"></div><div class="skeleton h-4 w-1/4"></div></div>
                            </div>
                            <div class="skeleton-card space-y-4 mt-4">
                                <div class="skeleton h-5 w-4/5"></div>
                                <div class="skeleton h-4 w-2/3"></div>
                                <div class="flex space-x-4"><div class="skeleton h-4 w-1/4"></div><div class="skeleton h-4 w-1/4"></div></div>
                            </div>
                        </div>
                        <div id="empty-state" class="hidden text-center py-16 px-6 border-2 border-dashed border-[var(--border-color)] rounded-xl">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-12 h-12 mx-auto text-[var(--muted-foreground)]"><path fill-rule="evenodd" d="M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0016.5 9h-1.875a.375.375 0 01-.375-.375V6.75A3.75 3.75 0 0010.5 3H5.625zM7.5 15a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5A.75.75 0 017.5 15zm.75 2.25a.75.75 0 000 1.5H12a.75.75 0 000-1.5H8.25z" clip-rule="evenodd" /></svg>
                            <h3 class="mt-4 text-lg font-semibold">対象の論文はありません</h3><p class="mt-1 text-sm text-[var(--muted-foreground)]">論文を追加するか、フィルター条件を変更してください。</p>
                        </div>
                    </section>
                </div>
            </main>
        </div>

        <div id="other-page" class="hidden space-y-12">
            <div id="key-achievements-wrapper">
                <h3 class="text-xl font-bold mb-4">主要実績</h3>
                <div id="key-achievements-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    </div>
            </div>
            <div id="detailed-stats-wrapper">
                <h3 class="text-xl font-bold mb-4">詳細な統計</h3>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-[var(--card-background)] p-4 rounded-xl border border-[var(--border-color)]">
                         <h4 class="font-bold mb-2 text-center">月別読了論文数</h4>
                        <canvas id="monthly-reads-chart"></canvas>
                    </div>
                    <div class="bg-[var(--card-background)] p-4 rounded-xl border border-[var(--border-color)]">
                        <h4 class="font-bold mb-2 text-center">カテゴリ別読了数</h4>
                        <div class="max-w-xs mx-auto">
                           <canvas id="category-reads-chart"></canvas>
                        </div>
                    </div>
                    <div class="bg-[var(--card-background)] p-4 rounded-xl border border-[var(--border-color)]">
                         <h4 class="font-bold mb-2 text-center">発表年の分布</h4>
                        <canvas id="year-distribution-chart"></canvas>
                    </div>
                    <div class="bg-[var(--card-background)] p-4 rounded-xl border border-[var(--border-color)]">
                        <h4 class="font-bold mb-2 text-center">読了論文 著者ランキング Top 10</h4>
                        <div id="top-authors-container" class="space-y-2"></div>
                    </div>
                </div>
            </div>
            <div id="contribution-graph-wrapper" class="p-4 md:p-6 bg-[var(--card-background)] border border-[var(--border-color)] rounded-xl shadow-sm">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-bold text-base">過去1年間の読了記録</h3>
                    <div class="flex items-center gap-2 text-xs text-[var(--muted-foreground)]">
                        0
                        <div class="graph-day w-3 h-3"></div>
                        <div class="graph-day level-4 w-3 h-3"></div>
                        1枚以上
                    </div>
                </div>
                <div class="flex gap-3">
                    <div id="graph-days" class="grid grid-rows-7 text-xs text-[var(--muted-foreground)] shrink-0">
                    </div>
                    <div id="contribution-graph-container" class="overflow-x-auto relative pt-6">
                        <div id="graph-months" class="absolute top-0 left-0 text-xs text-[var(--muted-foreground)] h-4 mb-2"></div>
                        <div id="graph-grid"></div>
                    </div>
                </div>
            </div>
            <div id="category-stats-wrapper">
                 <h3 class="text-xl font-bold mb-4">カテゴリ別読了数（サマリー）</h3>
                 <div id="category-stats-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                 </div>
            </div>
        </div>
    </div>

    <script src="/__/firebase/8.10.1/firebase-app.js"></script>
    <script src="/__/firebase/8.10.1/firebase-auth.js"></script>
    <script src="/__/firebase/8.10.1/firebase-firestore.js"></script>
    <script src="/__/firebase/init.js"></script>
    <script src="script.js"></script>
</body>
</html>